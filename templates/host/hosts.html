{% extends 'layout.html'%}
{% load rbac %}
{% block page_title %}服务器{% endblock %}
{% block page %}服务器{% endblock %}
{% block custom_css %}
    <link rel="stylesheet" href="/static/bootstrap-table/css/bootstrap-table.css">


{% endblock %}

{% block content %}
    <div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
                <div class="col-lg-12">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>服务器</h5>
                        </div>
                        <div class="ibox-content">
                        <div class="btn-group hidden-xs" id="asset-list-table-Toolbar" role="group">
                            {% if request|has_permission:'host:host_add' %}
                                    <a href="{% url 'host:host_add' %}" class="btn btn-sm btn-default">
                                        <i class="glyphicon glyphicon-plus" aria-hidden="true"></i>添加主机
                                    </a>
                            {% endif %}
                                <a href="{% url 'host:import' %}" class="btn btn-sm btn-default">
                                        <i class="fa fa-cloud-upload" aria-hidden="true"></i>导入主机
                                    </a>
                                </div>
                        <table id="asset-list-table-events"
                               class="table  table-hover"
                               data-url="{% url 'host:assetjson' %}"
                               data-method="get"
                               data-pagination="true"
                               data-side-pagination="server"
                               data-page-list="[10, 20, 50, 100, ALL]"
                               data-pagination-h-align="left"
                               data-pagination-detail-h-align="right"
                               data-pagination-pre-text="上一页"
                               data-pagination-next-text="下一页"
                               data-pagination-loop="false"
                               data-toolbar="#asset-list-table-Toolbar"
                               data-search="true"
                               data-select-item-name="id"
                               data-search-on-enter-key="true"
                               data-show-refresh="true"
                               data-show-columns="true"
                               data-show-export="true"
                               data-page-size=10
                               data-unique-id="id"
                               data-buttons-class="primary"
                               data-icons-prefix="glyphicon"
                               data-icons="icons"
                               data-icon-size="sm"
                               data-icon-aria-hidden="true"
                            data-query-params="queryParams"
                            data-detail-view="true"
                            data-detail-formatter="detailFormatter">
                        </table>
                        </div>
                    </div>
                </div>
            </div>
    </div>

{% endblock %}
{% block custom_js %}
    <script src="/static/bootstrap-table/js/tableExport.min.js"></script>
    <script src="/static/bootstrap-table/js/bootstrap-table.min.js"></script>
    <script src="/static/bootstrap-table/js/bootstrap-table-zh-CN.min.js"></script>
    <script src="/static/bootstrap-table/extensions/export/bootstrap-table-export.min.js"></script>

    <script>
        var $table = $('#asset-list-table-events');
        function initTable() {
            $table.bootstrapTable('destroy').bootstrapTable({
            columns:[[{
            field:'state',
            checkbox:true,
            aligin:'center'
            },
            {field:'id',
            title:'ID',
            sortable:true,
            },
            {field:'wip',
            title:'外网地址',
            sortable: true,
            },
            {field:'nip',
            title:'内网地址',
            sortable:true
            },
            {field:'hostname',
            title:'主机名'},
            {field:'server_type',
            title:'主机类型',
            formatter:function (value,row,index) {
                if(row['server_type']==='physical'){
                    return '<span style="color:#c0dbff">物理机</span>';
                }
                if(row['server_type']==='virtual'){
                    return '<span style="color:#19ddff">虚拟机</span>';
                }
                if(row['server_type']==='instance'){
                    return '<span style="color:#f06292">云主机</span>';
                }
            }
            },
            {field:'status',
            title:'状态',
            formatter:function (value,row,index) {
                if (row['status']==='online'){
                    return '<span style="color:green">上线</span>';
                }
                if (row['status']==='offline'){
                    return '<span style="color:red">下线</span>';
                }
            }

            },
            {field:'cpu',
            title:'CPU',
            visible:false
            },
            {field:'memory',
            title:'内存',
            visible:false
            },
            {field:'disk',
            title:'硬盘',
            visible:false},
            {field:'os',
            title:'操作系统',
            visible:false
            },
            {field:'remote_user',
            title:'远程用户',
            visible:false
            },
            {field:'ctime',
            title:'创建时间'},
            {% if request|has_permission:'host:host_update' or request|has_permission:'host:host_delete' or request|has_permission:'webssh:sshconnect' or request|has_permission:'webssh:filemanage' or request|has_permission:'webssh:dynamicpassword' %}
            {field:'operate',
            title:'操作',
            align: 'center',
            formatter:"operateFormatter"
            }
            {% endif %}
            ]],
            queryParams: function (params) {
            return {
                offset: params.offset,  //页码
                limit: params.limit,   //页面大小
                search : params.search, //搜索
                order : params.order, //排序
                sort : params.sort, //排序
            };
        },
                }
            )
        }
        window.icons = {
            refresh: 'glyphicon-refresh',
            columns: 'glyphicon-list',
            export: 'glyphicon-download',
            detailOpen: 'glyphicon-plus',
            detailClose:'glyphicon-minus',
        };
        function detailFormatter(index, row) {
    var html = []
    $.each(row, function (key, value) {
      html.push('<p><b>' + key + ':</b> ' + value + '</p>')
    })
    return html.join('')
  }
  function operateFormatter(value,row,index){
            return [
                {%  if request|has_permission:'host:host_update' %}
                '<a class="btn btn-xs btn-info" href="/host/host/update/'+row['id']+'/"><i class="fa fa-edit"></i></a>',
                {% endif %}
                {%  if request|has_permission:'webssh:sshconnect' %}
                '<a class="btn btn-xs btn-default" href="/webssh/sshconnect/'+row['wip']+'/'+row['id']+'/"><i class="fa fa-linux"></i></a>',
                {%  endif %}
                {%  if request|has_permission:'webssh:filemanage' %}
                '<a class="btn btn-xs btn-default" href="/webssh/filemanage/'+row['wip']+'/'+row['id']+'/"><i class="fa fa-folder-open"></i></a>',
                {%  endif %}
                {%  if request|has_permission:'host:host_delete' %}
                '<a class="btn btn-xs btn-danger" href="/host/host/delete/'+row['id']+'/"><i class="fa fa-trash"></i></a>'
                {%  endif %}
                        ].join('')
  }
        $(function(){initTable()})












    </script>
{% endblock %}